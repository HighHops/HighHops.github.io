!function(e){var t={project:{preload:[],namespace:'ym',jsonpPrefix:"",loadLimit:500},ns:{},env:{},envCallbacks:[]};t.modules=e['ym'].modules;var o=t.modules.define;t.modules.define=function(){t.modules.isDefined(arguments[0])||o.apply(t.modules,arguments)},t.modules.define("constructor.show",["util.defineClass","vow","data.Manager","Monitor","ObjectManager","option.presetStorage","constructor.show.options","constructor.show.prepareMapData","constructor.show.selectObject","util.array","objectManager.addon.objectsBalloon","objectManager.addon.clustersBalloon","constructor.show.fix"],function(e,t,o,n,s,r,i,a,c,l,u){var p=t(function(e,t,o){this._map=e,this.state=new n,this._fillPresets(t),this._setupOM(t,o),this._setupListeners()},{destroy:function(){this._teardownOM(),this._teardownListeners()},selectObject:function(e,t){if(!this._objectManagers)return o.reject(new Error("constructor.show was removed from map"));var n;return u.each(this._objectManagers,function(o){var s=o.getObjectState(e);return s.found&&(n=l(o,e,t)),!Boolean(n)},this),n?n.then(function(e){return this.state.set("selectedObjectId",e.objectId),e},this):o.reject(new Error("Object was not found"))},_fillPresets:function(e){var t=e.presetStorage;for(var o in t)t.hasOwnProperty(o)&&i.add(o,t[o])},_setupOM:function(e,t){var o=[];o.placemarks=new r({clusterize:!0}),o.figure=new r,o.push(o.placemarks,o.figure),a.set(o.placemarks,t),a.set(o.figure,t);var n=c(e);o.placemarks.add(n.placemarks),o.figure.add(n.figure),this._map.geoObjects.add(o.placemarks).add(o.figure),this._objectManagers=o},_teardownOM:function(){this._objectManagers&&(u.each(this._objectManagers,function(e){e.removeAll(),this._map.geoObjects.remove(e)},this),this._objectManagers=null)},_setupListeners:function(){this._clustersMonitors=[],this._omListeners=[],u.each(this._objectManagers,function(e){this._omListeners.push(e.objects.events.group().add("click",function(e){this.selectObject(e.get("objectId"),{coords:e.get("coords"),fitToViewport:!1})},this).add("balloonopen",function(e){this._setObjectWithBalloonId(e.get("objectId"))},this).add("balloonclose",function(){this._setObjectWithBalloonId()},this));var t=new s(e.clusters.state);t.add("activeObject",function(e){this._setObjectWithBalloonId(e.id)},this),this._clustersMonitors.push(t)},this)},_teardownListeners:function(){u.each(this._clustersMonitors,function(e){e.destroy()}),u.each(this._omListeners,function(e){e.removeAll()})},_setObjectWithBalloonId:function(e){this.state.set({selectedObjectId:e,objectWithBalloonId:e})}});e(function(e,t,n){return o.resolve(new p(e,t,n))})}),t.modules.define("constructor.show.fix",["geoObject.balloonPositioner.circle","geoObject.balloonPositioner.point","geoObject.balloonPositioner.polygon","geoObject.balloonPositioner.lineString","geoObject.balloonPositioner.rectangle","geoObject.balloonPositioner.multi"],function(e){e(!0)}),t.modules.define("constructor.show.options",["templateLayoutFactory","util.extend","layout.PieChart"],function(e,t,o,n){e({set:function(e,s){var r=t.createClass("{{ properties.iconContent }}",{build:function(){r.superclass.build.call(this);var e=this.getData().properties.iconContent;if(e&&String(e).length>2){var t=this.getElement();t.style.fontSize="9px",t.style.lineHeight="16px",t.style.display="block"}}}),i=t.createClass("{{ properties.name|raw }}"),a=o({minClusterSize:1e4,clusterIconLayout:n,clusterBalloonItemContentLayout:i,geoObjectStrokeOpacity:1,geoObjectFillOpacity:1,geoObjectStrokeColor:"ff0000e6",geoObjectStrokeWidth:5,geoObjectFillColor:"ff000099",geoObjectBalloonContentLayout:i,geoObjectIconContentLayout:r,geoObjectZIndexActive:Math.pow(10,9)+10,geoObjectZIndexHover:Math.pow(10,9)+9,geoObjectOpenBalloonOnClick:!1},s);e.options.set(a)}})}),t.modules.define("constructor.show.prepareMapData",function(e){e(function(e){e=e.maps&&e.maps[0];var t=e.geoObjects.features,o=[],n=[];return t.forEach(function(e){e.properties.name&&(e.properties.clusterCaption=e.properties.name);var t=e.geometry.type.toLowerCase();"point"===t?o.push(e):(n.push(e),"polygon"===t&&(e.geometry.fillRule="evenOdd"),e.options.zIndexHover=e.options.zIndex)}),{placemarks:{type:"FeatureCollection",features:o},figure:{type:"FeatureCollection",features:n}}})}),t.modules.define("constructor.show.selectObject",["util.bounds","vow","util.extend"],function(e,t,o,n){function s(e,t,n){var s=e.getMap();if(!s)return o.reject();var r,i=e.objects.getById(t);if(!i.properties||!i.properties.name)return s.balloon.isOpen()&&s.balloon.close(),o.resolve({status:"mapStateWasApplied",objectId:t});var a;return n&&n.coords&&(a=s.options.get("projection").toGlobalPixels(n.coords,s.getZoom())),r=e.objects.balloon.open(t,a),r.then(function(){return{status:"balloonWasOpened",objectId:t}})}function r(e){return t.fromPoints(e.toString().split(",").map(Number).reduce(function(e,t,o,n){return o%2>0&&e.push([n[o-1],t]),e},[]))}var i={useMapMargin:!0,duration:300},a={fitToViewport:!0};e(function(e,o,c){c=n({},a,c);var l=e.objects.getById(o).geometry,u=e.getMap(),p=u.getBounds(i),d=l.coordinates;if("point"===l.type.toLowerCase())return!c.fitToViewport||t.containsPoint(p,d)?s(e,o,c):u.setCenter(d,u.getZoom(),i).then(function(){return s(e,o,c)});var f=r(d);return!c.fitToViewport||t.containsBounds(p,f)?s(e,o,c):u.setBounds(f,i).then(function(){return s(e,o,c)})})})}(this);